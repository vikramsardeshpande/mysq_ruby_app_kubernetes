pipeline {
    agent any
 //   environment {
   //     s3_bucket = "persistent-demo1"
     //           }
    parameters { string(name: 'S3_BUCKET', defaultValue: 'persistent-demo1', description: 'This bucket is use to store the stage files')
                 string(name: 'KUBERNET_CLUSTER_NAME', defaultValue: 'persistent-k8s-demo.k8s.local', description: 'Kubernet Cluster Name, 1 - master & 2 nodes')
                 choice(name: 'CLUSTER_CHOICE', choices: ['Create', 'Destory'], description: 'Pick your Choice')
               }
    
    stages{
        stage ('Create S3 Bucket') {
            steps {
                sh "aws s3api create-bucket --bucket ${params.S3_BUCKET} --region ap-south-1 --create-bucket-configuration LocationConstraint=ap-south-1"
                  }
             }
        stage('Kubernet Cluster') {
                  when {
                // Only say hello if a "greeting" is requested
                      expression { ${params.CLUSTER_CHOICE} == 'Create' }
                     }
                  steps {
                        sh "export KOPS_STATE_STORE=s3://${params.S3_BUCKET}"
                        echo "Hello, Create"
                        }
                    }
              }
        stage('Kubernet Cluster') {
                  when {
                // Only say hello if a "greeting" is requested
                      expression { ${params.CLUSTER_CHOICE} == 'Destory' }
                     }
                  steps {
                        sh "export KOPS_STATE_STORE=s3://${params.S3_BUCKET}"
                        echo "Hello, Destory"
                        }
                    }
               }
           }
        }
    
